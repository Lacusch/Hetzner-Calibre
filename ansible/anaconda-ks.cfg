# Generated by Anaconda 34.25.5.17
# Generated by pykickstart v3.32
#version=RHEL9
# Use graphical install
graphical
repo --name="AppStream" --baseurl=file:///run/install/sources/mount-0000-hdd-device/AppStream

%addon com_redhat_kdump --enable --reserve-mb='auto'

%end

# Keyboard layouts
keyboard --xlayouts='us'
# System language
lang en_US.UTF-8

# Network configuration - DHCP (remove if you want static IP)
network --bootproto=dhcp --device=link --activate --onboot=on --hostname=homelab-server

# Use hard drive installation media
harddrive --dir= --partition=/dev/sdb2

# Services configuration
services --enabled=sshd,chronyd
firewall --enabled --service=ssh

%packages
@^minimal-environment
openssh-server
openssh-clients
%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.6.0
ignoredisk --only-use=sda
# Partition clearing information
clearpart --none --initlabel
# Disk partitioning information
part /boot --fstype="xfs" --ondisk=sda --size=1024
part /boot/efi --fstype="efi" --ondisk=sda --size=512 --fsoptions="umask=0077,shortname=winnt"
part swap --fstype="swap" --ondisk=sda --size=512
part / --fstype="xfs" --ondisk=sda --grow

# System timezone

timezone UTC --utc --ntpservers=pool.ntp.org

#Root password
rootpw --lock
user --groups=wheel --name=szabola --password=$6$BwOpQRxQxB3ItUMM$HZkOhxX3VtRd53aEz8BuMFEOj.vW5eDf86TpvSZt44PfB8QkFhc.Dvc3VD6uZsS4bQhTgwGKce8du8JGuB8to. --iscrypted --gecos="Laszlo M. Szabo"

# Post-installation script to set up SSH keys
%post --log=/var/log/ks-post.log
# Create SSH directory for user
mkdir -p /home/szabola/.ssh
chmod 700 /home/szabola/.ssh

# Add your SSH public key here
cat > /home/szabola/.ssh/authorized_keys << 'EOF'
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIE/htaCAT3gbQDSlPQDhhsUnQO1ML18RuBu6Brrek6mu szabo.lacus.2001@gmail.com
EOF

# Set proper permissions
chmod 600 /home/szabola/.ssh/authorized_keys
chown -R szabola:szabola /home/szabola/.ssh

# Optional: Disable password authentication (uncomment if you want key-only)
sed -i 's/#PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config
sed -i 's/PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config

%end
reboot
